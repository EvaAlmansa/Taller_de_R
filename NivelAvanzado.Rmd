---
title: "NivelAvanzado"
author: '@ana_valdi'
date: "2 de mayo de 2017"
output: rmarkdown::github_document
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Tutorial para Nivel Avanzado de R

En este tutorial vamos a aprender como enfrentarnos a una competición de **Kaggle**. Utilizaremos nuestros conocimientos en R y Machine Learning.

La competición que hemos elegido es **Titanic: Machine Learning from Disaster**: <https://www.kaggle.com/c/titanic>.

Titanic fue un transatlántico que naufragó la noche del 14 de abril de 1912 al chocar contra un iceberg. Este hecho provocó la muerte de 1.515 personas (de un total de 2.224). Debido a las consecuencias de esta tragedia, el naufragió del Titanic se ha convertido en un de los más famosos de la historia. 

El objetivo de esta competición es el de predecir qué personas sobrevivieron. 


## Descargar los Datasets

El primer paso que debemos realizar es la descarga de datos. Para ellos, iremos al link: <https://www.kaggle.com/c/titanic/data> y procederemos a la descarga.

Los archivos los guardaremos en una carpeta que llamaremos **data**.

## Librerías que Vamos a Utilizar

Es importante que instalemos y carguemos las librerías siguientes antes de empezar el tutorial:
`ggplot2, reshape2, caret`:

```{r}
require(ggplot2)

require(reshape2)

require(caret)
```

## Importar los Datasets a R

Primero vamos a configurar nuestro espacio de trabajo. Para ello, vamos a decirle a R en qué carpeta vamos a trabajar:

```{r}
setwd("C:/Users/Ana/Dropbox (Personal)/AlhambraAnalytics/TallerR/")
```

Leemos los datasets:

```{r}
train <- read.csv("./data/train.csv")
test <- read.csv("./data/test.csv")
gender_submission <- read.csv("./data/gender_submission.csv")
```

## Analizar la Estructura de los Datasets

La función `str` nos devuelve la estructura del dataset. Nos informa de cuántas observaciones y variables contiene el dataset. Además, también nos devuelve de las clases de las variables:

```{r echo = TRUE}
str(train)
str(test)
str(gender_submission)
```

No obstante, si sólo queremos obtener información de la clase podemos ejecutar la siguiente orden:

```{r echo = TRUE}
lapply(train, class)
lapply(test, class)
lapply(gender_submission, class)
```

- **Ejercicio 1:** ¿Existe alguna variable que sea `character`? ¿Crees que se debería de cambiar la clase de alguna de las variables?

La función `summary` devuelve un resumen por cada variable:

```{r echo = TRUE}
summary(train)
summary(test)
summary(gender_submission)
```

- **Ejercicio 2:** ¿Cuál es la media de la variable `Survived`? ¿Y la mediana? ¿Qué relación existe entre estas dos medidas estadísticas?

## Algunas Gráficas

Siempre es aconsejable acompañar las medidas estadísticas con alguna gráfica para hacernos una idea general del comportamiendo de los datos. La librería que utilizaremos es `ggplot2`, capaz de realizar gráficos excelentes (si sabemos cómo manejarla...). En este caso, vamos a realizar un histograma de train:

```{r echo = TRUE}
# Guardar las variables como factors
dataPlot <- train
nameVar <- c("Pclass", "Sex", "SibSp", "Parch", "Embarked", "Survived") 
dataPlot <- dataPlot[ ,nameVar]
dataPlot[ ,nameVar] <- lapply(dataPlot[,nameVar], as.factor)

# Histograma de las variables seleccionadas
meltData <- as.data.frame(melt(dataPlot, id.vars="Survived"))

ggplot(meltData, aes(x = value)) + facet_wrap(~variable, scales = "free") +
  geom_bar(aes(fill=Survived)) + scale_fill_manual(values=c("coral2", "cyan3")) + 
  ggtitle("Histograma") + theme(plot.title = element_text(lineheight=.8, face="bold")) 
```

- **Ejercicio 3:** Realiza el mismo histograma pero para las variables de test. ¿Tienen una distribución parecida?
- **Ejercicio 4:** ¿Se te ocurre otro gráfico que ayude a realizar un análisi visual de los datos?
- **Ejercicio 5:** ¿Si tuvieras que elegir una variable para explicar la clase (``Survived``), cuál eligirías? (*Pista:* [El mito de los naufrágeos](http://www.bbc.com/mundo/noticias/2012/04/120413_mujeres_ninos_primero_mito_adz.shtml))


## Primer Modelo

Según la variable que hayamos elegido en el **Ejercicio 5**, construiremos el primer modelo. Por ejemplo, observamos que la variable ``Sex`` muestra un comportamiento muy diferente en la superviviencia según si es ``Female`` o ``Male``:

```{r}
table(train$Sex, train$Survived)
prop.table(table(train$Sex, train$Survived))
```
Como observamos, perecieron muchos más hombres (52.52 %) que mujeres (0.09 %). Por lo tanto, vamos a crear nuestro primer modelo bajo la hipótesis que si eres mujer sobrevives y si eres hombre mueres:

```{r}
test$Survived <- ifelse(test$Sex == "female", 1, 0)

GenderModel <- data.frame(PassengerId = test$PassengerId, Survived = test$Survived)
write.csv(GenderModel, file = "GenderModel.csv", row.names = FALSE)
```

- **Ejercicio 6:** ¿Qué puntuación has obtenido?


## Primer Modelo

## Imputación de Valores Perdidos

Antes de construir un modelo de Machine Learning, debemos de 
